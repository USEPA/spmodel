<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Fit random forest spatial residual models
for point-referenced data (i.e., geostatistical models) using
random forest to fit the mean and a spatial linear model to fit the residuals.
The spatial linear model fit to the residuals can incorporate variety of estimation methods,
allowing for random effects, anisotropy, partition factors, and big data methods."><title>Fit random forest spatial residual models — splmRF • spmodel</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit random forest spatial residual models — splmRF"><meta property="og:description" content="Fit random forest spatial residual models
for point-referenced data (i.e., geostatistical models) using
random forest to fit the mean and a spatial linear model to fit the residuals.
The spatial linear model fit to the residuals can incorporate variety of estimation methods,
allowing for random effects, anisotropy, partition factors, and big data methods."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spmodel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/guide.html">A Detailed Guide to spmodel</a>
    <a class="dropdown-item" href="../articles/SPGLMs.html">Spatial Generalized Linear Models in spmodel</a>
    <a class="dropdown-item" href="../articles/technical.html">Technical Details</a>
    <a class="dropdown-item" href="../articles/introduction.html">An Introduction to spmodel</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USEPA/spmodel/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fit random forest spatial residual models</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/spmodel/blob/HEAD/R/splmRF.R" class="external-link"><code>R/splmRF.R</code></a></small>
      <div class="d-none name"><code>splmRF.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fit random forest spatial residual models
for point-referenced data (i.e., geostatistical models) using
random forest to fit the mean and a spatial linear model to fit the residuals.
The spatial linear model fit to the residuals can incorporate variety of estimation methods,
allowing for random effects, anisotropy, partition factors, and big data methods.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">splmRF</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>A two-sided linear formula describing the fixed effect structure
of the model, with the response to the left of the <code>~</code> operator and
the terms on the right, separated by <code>+</code> operators.</p></dd>


<dt>data</dt>
<dd><p>A data frame or <code>sf</code> object object that contains
the variables in <code>fixed</code>, <code>random</code>, and <code>partition_factor</code>
as well as geographical information. If an <code>sf</code> object is
provided with <code>POINT</code> geometries, the x-coordinates and y-coordinates
are used directly. If an <code>sf</code> object is
provided with <code>POLYGON</code> geometries, the x-coordinates and y-coordinates
are taken as the centroids of each polygon.</p></dd>


<dt>...</dt>
<dd><p>Additional named arguments to <code><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger::ranger()</a></code> or <code><a href="splm.html">splm()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with several elements to be used with <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>. These
elements include the function call (named <code>call</code>), the random forest object
fit to the mean (named <code>ranger</code>),
the spatial linear model object fit to the residuals
(named <code>splm</code> or <code>splm_list</code>), and an object can contain data for
locations at which to predict (called <code>newdata</code>). The <code>newdata</code></p>


<p>object contains the set of
observations in <code>data</code> whose response variable is <code>NA</code>.
If <code>spcov_type</code> or <code>spcov_initial</code> (which are passed to <code><a href="splm.html">splm()</a></code>)
are length one, the list has class <code>splmRF</code> and the spatial linear
model object fit to the residuals is called <code>splm</code>, which has
class <code>splm</code>. If
<code>spcov_type</code> or <code>spcov_initial</code> are length greater than one, the
list has class <code>splmRF_list</code> and the spatial linear model object
fit to the residuals is called <code>splm_list</code>, which has class <code>splm_list</code>.
and contains several objects, each with class <code>splm</code>.</p>


<p>An <code>splmRF</code> object to be used with <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>. There are
three elements: <code>ranger</code>, the output from fitting the mean model with
<code><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger::ranger()</a></code>; <code>splm</code>, the output from fitting the spatial
linear model to the ranger residuals; and <code>newdata</code>, the <code>newdata</code></p>


<p>object, if relevant.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The random forest residual spatial linear model is described by
Fox et al. (2020). A random forest model is fit to the mean portion of the
model specified by <code>formula</code> using <code><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger::ranger()</a></code>. Residuals
are computed and used as the response variable in an intercept-only spatial
linear model fit using <code><a href="splm.html">splm()</a></code>. This model object is intended for use with
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> to perform prediction, also called random forest
regression Kriging.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function does not perform any internal scaling. If optimization is not
stable due to large extremely large variances, scale relevant variables
so they have variance 1 before optimization.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fox, E.W., Ver Hoef, J. M., &amp; Olsen, A. R. (2020). Comparing spatial
regression to random forests for large environmental data sets.
<em>PloS one</em>, 15(3), e0229509.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">sulfate</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">sulfate</span><span class="op">)</span><span class="op">)</span> <span class="co"># add noise variable</span></span></span>
<span class="r-in"><span><span class="va">sulfate_preds</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">sulfate_preds</span><span class="op">)</span><span class="op">)</span> <span class="co"># add noise variable</span></span></span>
<span class="r-in"><span><span class="va">sprfmod</span> <span class="op">&lt;-</span> <span class="fu">splmRF</span><span class="op">(</span><span class="va">sulfate</span> <span class="op">~</span> <span class="va">var</span>, data <span class="op">=</span> <span class="va">sulfate</span>, spcov_type <span class="op">=</span> <span class="st">"exponential"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">sprfmod</span>, <span class="va">sulfate_preds</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           1           2           3           4           5           6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4.14811155 34.20366825  7.33453772 17.96184350 -3.20490296 20.96357210 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           7           8           9          10          11          12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9.77333126 21.59431036  0.28085046 19.32424259  5.44592523 24.02731993 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          13          14          15          16          17          18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -2.60319702 12.99030552 21.81919201 12.42642421 15.81365970 10.23612701 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          19          20          21          22          23          24 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4.82310554 19.47580449 19.44629206 -0.67681325 12.71849847  7.89390537 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          25          26          27          28          29          30 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.31965151 -6.06491078 16.96911644  5.23163711 26.14082233  6.72592416 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          31          32          33          34          35          36 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -7.97086704 -1.46909096  8.41488984 -5.95366612 -0.16525209 11.86042576 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          37          38          39          40          41          42 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28.29883688  4.55385400 14.78311298 14.65466761  8.89136914 22.09187490 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          43          44          45          46          47          48 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16.98782287 19.37465814 -1.22987449 10.88408872  9.69769160 15.57709856 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          49          50          51          52          53          54 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15.90109210 -3.39214162 20.02784106 18.82558258  9.79976485 -2.18033791 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          55          56          57          58          59          60 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4.58115158 16.03624652 12.38814855  3.91411523 15.28622635  8.25106583 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          61          62          63          64          65          66 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26.33957296 27.14301775 -5.53676321 18.01290386 22.10296575 -5.41299038 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          67          68          69          70          71          72 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -6.91367097  0.91370651 -2.39102508  5.79030840  0.76894428 16.71802523 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          73          74          75          76          77          78 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16.30935629  3.27766360 -2.28821455 -4.59497990 18.65988727 -4.33394655 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          79          80          81          82          83          84 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23.08629834 18.08347153 19.71114413  0.01135263  2.54490969 -5.31786728 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          85          86          87          88          89          90 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -2.57431174  0.80961825  2.76179784 -1.58677621 -2.92853432 17.20972966 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          91          92          93          94          95          96 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2.80647555  4.82133299 14.37001905 32.80365573 11.57957115 14.61975234 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          97          98          99         100 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22.06148557 12.87569700 18.36816546 14.23775635 </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Michael Dumelle, Matt Higham, Jay M. Ver Hoef.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

